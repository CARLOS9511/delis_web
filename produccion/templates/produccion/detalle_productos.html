{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ producto.nombre }} - DELIS</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px 0;
        }
        
        .info-card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 4px 16px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .info-row {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .info-row:last-child {
            border-bottom: none;
        }
        
        .info-row span:first-child {
            color: #666;
            font-weight: 500;
        }
        
        .info-row span:last-child {
            color: #333;
            font-weight: 600;
        }
        
        .badge-custom {
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.95rem;
        }
        
        .badge-activo {
            background: #d1fae5;
            color: #065f46;
        }
        
        .badge-inactivo {
            background: #fee2e2;
            color: #991b1b;
        }
        
        .badge-stock-ok {
            background: #d1fae5;
            color: #065f46;
        }
        
        .badge-stock-bajo {
            background: #fed7aa;
            color: #9a3412;
        }
        
        .badge-sin-stock {
            background: #fee2e2;
            color: #991b1b;
        }
        
        .stat-box {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            margin-bottom: 20px;
        }
        
        .stat-box h3 {
            font-size: 2.5rem;
            margin-bottom: 5px;
            font-weight: 700;
        }
        
        .stat-box p {
            margin: 0;
            opacity: 0.9;
            font-size: 0.95rem;
        }
        
        .btn {
            padding: 12px 25px;
            border-radius: 8px;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .btn:hover {
            transform: translateY(-2px);
        }
        
        .card {
            border: none;
            border-radius: 12px;
            box-shadow: 0 4px 16px rgba(0,0,0,0.1);
        }
        
        .card-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 12px 12px 0 0 !important;
            padding: 1rem 1.25rem;
            font-weight: 600;
        }
        
        .precio-box {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
        }
        
        .precio-label {
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 5px;
        }
        
        .precio-valor {
            font-size: 1.8rem;
            font-weight: 700;
            color: #10b981;
        }
        
        .alert {
            border-radius: 8px;
            border: none;
            padding: 15px 20px;
        }
    </style>
</head>
<body>
    <div class="container mt-4">
        <!-- Header -->
        <div class="d-flex justify-content-between align-items-center mb-4">
            <div>
                <h2 class="text-white">
                    <i class="fas fa-box"></i> 
                    Detalle del Producto
                </h2>
                <p class="text-white-50 mb-0">{{ producto.codigo }} - {{ producto.nombre }}</p>
            </div>
            <div class="btn-group">
                <a href="{% url 'produccion:lista' %}" class="btn btn-outline-light">
                    <i class="fas fa-arrow-left"></i> Volver
                </a>
                <a href="{% url 'produccion:editar' producto.id %}" class="btn btn-warning text-white">
                    <i class="fas fa-edit"></i> Editar
                </a>
            </div>
        </div>

        {% if messages %}
        <div class="mb-4">
            {% for message in messages %}
            <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                <i class="fas fa-{% if message.tags == 'success' %}check-circle{% else %}exclamation-circle{% endif %}"></i>
                {{ message }}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>
            {% endfor %}
        </div>
        {% endif %}

        <div class="row">
            <!-- Columna Principal -->
            <div class="col-lg-8">
                <!-- Información General -->
                <div class="info-card">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h4 class="mb-0">
                            <i class="fas fa-info-circle text-primary"></i> 
                            Información General
                        </h4>
                        <span class="badge-custom {% if producto.activo %}badge-activo{% else %}badge-inactivo{% endif %}">
                            {% if producto.activo %}
                                <i class="fas fa-check-circle"></i> Activo
                            {% else %}
                                <i class="fas fa-times-circle"></i> Inactivo
                            {% endif %}
                        </span>
                    </div>
                    
                    <div class="info-row">
                        <span><i class="fas fa-barcode"></i> Código:</span>
                        <strong>{{ producto.codigo }}</strong>
                    </div>
                    <div class="info-row">
                        <span><i class="fas fa-birthday-cake"></i> Nombre:</span>
                        <strong>{{ producto.nombre }}</strong>
                    </div>
                    <div class="info-row">
                        <span><i class="fas fa-tag"></i> Categoría:</span>
                        <strong>{{ producto.categoria.nombre|default:"Sin categoría" }}</strong>
                    </div>
                    <div class="info-row">
                        <span><i class="fas fa-hashtag"></i> Código Producto:</span>
                        <strong>{{ producto.codigo_producto }}</strong>
                    </div>
                </div>

                <!-- Información de Precios -->
                <div class="card mb-4">
                    <div class="card-header">
                        <i class="fas fa-money-bill-wave"></i> Información de Precios
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="precio-box">
                                    <div class="precio-label">Precio de Compra</div>
                                    <div class="precio-valor text-primary">
                                        Bs. {{ producto.precio_compra|floatformat:2 }}
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="precio-box">
                                    <div class="precio-label">Precio de Venta</div>
                                    <div class="precio-valor text-success">
                                        Bs. {{ producto.precio_venta|floatformat:2 }}
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="alert alert-info mt-3">
                            <div class="row">
                                <div class="col-md-6">
                                    <strong><i class="fas fa-chart-line"></i> Margen de Ganancia:</strong>
                                    <span class="float-end">{{ producto.margen }}%</span>
                                </div>
                                <div class="col-md-6">
                                    <strong><i class="fas fa-coins"></i> Ganancia por Unidad:</strong>
                                    <span class="float-end">Bs. {{ producto.ganancia|floatformat:2 }}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Información de Stock -->
                <div class="card mb-4">
                    <div class="card-header">
                        <i class="fas fa-boxes"></i> Información de Stock
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="info-row">
                                    <span>Stock Actual:</span>
                                    <strong class="text-primary">{{ producto.stock }} unidades</strong>
                                </div>
                                <div class="info-row">
                                    <span>Stock Mínimo:</span>
                                    <strong>{{ producto.stock_minimo }} unidades</strong>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="info-row">
                                    <span>Estado del Stock:</span>
                                    {% if producto.stock == 0 %}
                                        <span class="badge-custom badge-sin-stock">
                                            <i class="fas fa-exclamation-circle"></i> Sin Stock
                                        </span>
                                    {% elif producto.stock_bajo %}
                                        <span class="badge-custom badge-stock-bajo">
                                            <i class="fas fa-exclamation-triangle"></i> Stock Bajo
                                        </span>
                                    {% else %}
                                        <span class="badge-custom badge-stock-ok">
                                            <i class="fas fa-check-circle"></i> Stock OK
                                        </span>
                                    {% endif %}
                                </div>
                            </div>
                        </div>

                        <!-- Acciones de Stock -->
                        <div class="mt-4">
                            <h6 class="mb-3">Ajustar Stock:</h6>
                            <form method="post" action="{% url 'produccion:ajustar_stock' producto.id %}" class="row g-3">
                                {% csrf_token %}
                                <div class="col-md-5">
                                    <input type="number" name="cantidad" class="form-control" placeholder="Cantidad" min="1" required>
                                </div>
                                <div class="col-md-7">
                                    <div class="btn-group w-100" role="group">
                                        <button type="submit" name="accion" value="agregar" class="btn btn-success">
                                            <i class="fas fa-plus"></i> Agregar
                                        </button>
                                        <button type="submit" name="accion" value="quitar" class="btn btn-danger">
                                            <i class="fas fa-minus"></i> Quitar
                                        </button>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- Historial -->
                <div class="info-card">
                    <h5 class="mb-3">
                        <i class="fas fa-clock text-primary"></i> Historial
                    </h5>
                    <div class="info-row">
                        <span>Fecha de Creación:</span>
                        <strong>{{ producto.fecha_creacion|date:"d/m/Y H:i" }}</strong>
                    </div>
                    <div class="info-row">
                        <span>Última Actualización:</span>
                        <strong>{{ producto.fecha_actualizacion|date:"d/m/Y H:i" }}</strong>
                    </div>
                </div>
            </div>

            <!-- Columna Lateral -->
            <div class="col-lg-4">
                <!-- Estadísticas Rápidas -->
                <div class="stat-box">
                    <h3>{{ producto.stock }}</h3>
                    <p>Unidades en Stock</p>
                </div>

                <div class="stat-box" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                    <h3>Bs. {{ producto.precio_venta|floatformat:2 }}</h3>
                    <p>Precio de Venta</p>
                </div>

                <!-- Acciones Rápidas -->
                <div class="card mb-4">
                    <div class="card-header">
                        <i class="fas fa-bolt"></i> Acciones Rápidas
                    </div>
                    <div class="card-body">
                        <div class="d-grid gap-2">
                            <a href="{% url 'produccion:editar' producto.id %}" class="btn btn-warning">
                                <i class="fas fa-edit"></i> Editar Producto
                            </a>
                            
                            {% if producto.activo %}
                            <form method="post" action="{% url 'produccion:toggle' producto.id %}" class="d-inline">
                                {% csrf_token %}
                                <button type="submit" class="btn btn-secondary w-100">
                                    <i class="fas fa-eye-slash"></i> Desactivar
                                </button>
                            </form>
                            {% else %}
                            <form method="post" action="{% url 'produccion:toggle' producto.id %}" class="d-inline">
                                {% csrf_token %}
                                <button type="submit" class="btn btn-success w-100">
                                    <i class="fas fa-eye"></i> Activar
                                </button>
                            </form>
                            {% endif %}
                            
                            <a href="{% url 'produccion:eliminar' producto.id %}" class="btn btn-danger">
                                <i class="fas fa-trash"></i> Eliminar Producto
                            </a>
                        </div>
                    </div>
                </div>

                <!-- Información Adicional -->
                <div class="info-card">
                    <h6 class="mb-3">
                        <i class="fas fa-info-circle text-primary"></i> Información Adicional
                    </h6>
                    <small class="text-muted d-block mb-2">
                        <i class="fas fa-cube"></i> 
                        <strong>ID:</strong> {{ producto.id }}
                    </small>
                    {% if producto.imagen %}
                    <small class="text-muted d-block mb-2">
                        <i class="fas fa-image"></i> 
                        <strong>Imagen:</strong> 
                        <a href="{{ producto.imagen.url }}" target="_blank">Ver imagen</a>
                    </small>
                    {% endif %}
                    <small class="text-muted d-block">
                        <i class="fas fa-dollar-sign"></i> 
                        <strong>Valor en Stock:</strong> 
                        Bs. {{ producto.valor_total_stock|floatformat:2 }}
                    </small>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>